# Screenshot to Eagle - 需求文档

## 1. 项目概述

### 1.1 项目名称
Screenshot to Eagle - Raycast 插件

### 1.2 项目描述
一个 Raycast 插件，用于调用 macOS 系统截图功能，并通过 Eagle Web API 自动将截图保存到用户指定的 Eagle 文件夹中。

### 1.3 目标用户
- 使用 macOS 系统的设计师、开发者
- 使用 Eagle 进行素材管理的用户
- 使用 Raycast 提升工作效率的用户

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 调用系统截图
- **功能描述**：调用 macOS 原生截图功能
- **实现方式**：
  - 区域截图（Capture Selection）：`screencapture -i`
  - 窗口截图（Capture Window）：`screencapture -w`
  - 全屏截图（Capture Screen）：`screencapture`
  - 延迟截图（Timed Capture）：`screencapture -T <seconds>`
- **截图保存**：临时保存到系统临时目录
- **文件格式**：PNG（默认）

#### 2.1.2 自动上传到 Eagle
- **功能描述**：截图完成后自动调用 Eagle Web API 上传
- **API 端点**：`POST http://localhost:41595/api/item/addFromURL`
- **上传方式**：
  - 方式1：读取临时文件转换为 Base64 格式上传
  - 方式2：提供本地文件路径（如果 Eagle 支持）
- **上传参数**：
  - `url`：Base64 编码的图片数据或文件路径
  - `name`：截图文件名（自动生成：Screenshot_YYYY-MM-DD_HH-mm-ss）
  - `folderId`：用户配置的目标文件夹 ID
  - `tags`：可选标签（默认：["screenshot", "raycast"]）
  - `modificationTime`：截图创建时间

#### 2.1.3 文件夹选择配置
- **功能描述**：用户可以配置默认保存的 Eagle 文件夹
- **配置方式**：
  - 在 Raycast 插件 Preferences 中配置
  - 提供文件夹 ID 输入框
  - 提供"获取文件夹列表"辅助功能
- **文件夹获取**：
  - 调用 `/api/folder/list` 获取所有文件夹
  - 调用 `/api/folder/listRecent` 获取最近使用的文件夹
  - 展示文件夹列表供用户选择

### 2.2 截图模式

#### 2.2.1 快捷截图（主命令）
- **命令名称**：Shot to Eagle
- **快捷键**：用户可自定义
- **默认行为**：调用区域截图
- **流程**：
  1. 触发命令
  2. 调用系统区域截图
  3. 用户选择截图区域
  4. 截图完成
  5. 自动上传到 Eagle
  6. 显示成功提示

#### 2.2.2 截图模式选择（扩展功能）
- **选项1**：区域截图（Interactive Selection）
- **选项2**：窗口截图（Window Capture）
- **选项3**：全屏截图（Full Screen）
- **选项4**：延迟截图（Timed Capture - 5秒倒计时）

### 2.3 用户提示与反馈

#### 2.3.1 进度提示
- 截图中：显示 HUD "Taking Screenshot..."
- 上传中：显示 HUD "Uploading to Eagle..."
- 成功：显示 HUD "✓ Saved to Eagle"
- 失败：显示错误提示

#### 2.3.2 错误处理
- 截图取消：不显示任何提示
- Eagle 未运行：提示 "Eagle is not running. Please start Eagle first."
- API 连接失败：提示 "Cannot connect to Eagle. Check if Eagle is running."
- 上传失败：提示具体错误信息
- 文件夹不存在：提示 "Folder not found. Please check your configuration."

## 3. 配置项需求

### 3.1 必需配置
- **Eagle API Token**：
  - 配置项：`eagleApiToken`
  - 类型：`string`
  - 必填：是
  - 默认值：从 .env 读取或手动配置
  - 说明：用于认证 Eagle Web API

- **Target Folder ID**：
  - 配置项：`folderId`
  - 类型：`string`
  - 必填：否
  - 默认值：空（保存到 Eagle 根目录）
  - 说明：截图保存的目标文件夹 ID

### 3.2 可选配置
- **Eagle API URL**：
  - 配置项：`eagleApiUrl`
  - 类型：`string`
  - 默认值：`http://localhost:41595`
  - 说明：Eagle Web API 地址

- **Default Screenshot Mode**：
  - 配置项：`defaultMode`
  - 类型：`dropdown`
  - 选项：`selection` | `window` | `screen` | `timed`
  - 默认值：`selection`
  - 说明：默认截图模式

- **Auto Add Tags**：
  - 配置项：`autoTags`
  - 类型：`string`
  - 默认值：`screenshot, raycast`
  - 说明：自动添加的标签（逗号分隔）

- **Include Cursor**：
  - 配置项：`includeCursor`
  - 类型：`boolean`
  - 默认值：`false`
  - 说明：截图是否包含鼠标指针

- **Screenshot Sound**：
  - 配置项：`playSound`
  - 类型：`boolean`
  - 默认值：`true`
  - 说明：是否播放截图音效

- **Timed Delay**：
  - 配置项：`timedDelay`
  - 类型：`number`
  - 默认值：`5`
  - 说明：延迟截图的秒数

## 4. 技术架构

### 4.1 技术栈
- **开发框架**：Raycast API v1.103.6+
- **语言**：TypeScript 5.8+
- **运行环境**：macOS
- **外部依赖**：
  - macOS `screencapture` 命令
  - Eagle App（必须运行）
  - Eagle Web API

### 4.2 核心模块

#### 4.2.1 截图模块（Screenshot Module）
- 功能：调用 macOS 截图命令
- 文件：`src/modules/screenshot.ts`
- 主要方法：
  - `captureSelection()`: 区域截图
  - `captureWindow()`: 窗口截图
  - `captureScreen()`: 全屏截图
  - `captureWithDelay(seconds)`: 延迟截图

#### 4.2.2 Eagle API 模块（Eagle API Module）
- 功能：与 Eagle Web API 交互
- 文件：`src/modules/eagle-api.ts`
- 主要方法：
  - `checkEagleStatus()`: 检查 Eagle 是否运行
  - `uploadScreenshot(filePath, options)`: 上传截图
  - `getFolderList()`: 获取文件夹列表
  - `getRecentFolders()`: 获取最近使用的文件夹

#### 4.2.3 配置模块（Config Module）
- 功能：管理插件配置
- 文件：`src/modules/config.ts`
- 主要方法：
  - `getConfig()`: 获取配置
  - `validateConfig()`: 验证配置

#### 4.2.4 工具模块（Utils Module）
- 功能：通用工具函数
- 文件：`src/utils/index.ts`
- 主要方法：
  - `generateFileName()`: 生成文件名
  - `fileToBase64()`: 文件转 Base64
  - `getTempFilePath()`: 获取临时文件路径

### 4.3 文件结构
```
screenshot-to-eagle/
├── src/
│   ├── shot-to-eagle.ts           # 主命令入口
│   ├── select-folder.ts           # 选择文件夹命令
│   ├── modules/
│   │   ├── screenshot.ts          # 截图模块
│   │   ├── eagle-api.ts           # Eagle API 模块
│   │   └── config.ts              # 配置模块
│   ├── utils/
│   │   └── index.ts               # 工具函数
│   └── types/
│       └── index.ts               # 类型定义
├── assets/
│   └── extension-icon.png
├── docs/
│   ├── 需求文档.md
│   ├── 技术实现文档.md
│   └── Eagle Web API.md
├── .env
├── package.json
├── tsconfig.json
└── README.md
```

## 5. 用户交互流程

### 5.1 首次使用流程
1. 用户安装插件
2. 打开 Raycast Preferences
3. 配置 Eagle API Token
4. （可选）配置目标文件夹 ID
5. 保存配置
6. 首次运行命令

### 5.2 日常使用流程
1. 用户通过 Raycast 触发 "Shot to Eagle" 命令
2. 系统进入截图模式（鼠标变为十字光标）
3. 用户选择截图区域
4. 确认截图
5. 插件显示 "Uploading to Eagle..." HUD
6. 截图自动上传到 Eagle
7. 显示成功提示 "✓ Saved to Eagle"
8. 用户可以在 Eagle 中查看截图

### 5.3 文件夹选择流程
1. 用户运行 "Select Eagle Folder" 命令
2. 插件获取 Eagle 文件夹列表
3. 显示文件夹列表（包含最近使用的文件夹）
4. 用户选择目标文件夹
5. 自动保存文件夹 ID 到配置
6. 显示确认提示

## 6. 非功能需求

### 6.1 性能要求
- 截图响应时间：< 1秒
- 上传时间：< 3秒（取决于图片大小和网络）
- 不阻塞 Raycast 主进程

### 6.2 可靠性要求
- 错误处理完善，不崩溃
- 网络异常时有重试机制（最多3次）
- 临时文件清理机制

### 6.3 兼容性要求
- macOS 12.0+
- Eagle 3.0+
- Raycast 1.50+

### 6.4 安全要求
- API Token 安全存储（使用 Raycast Preferences）
- 不在日志中输出敏感信息
- 临时文件及时清理

## 7. 扩展功能（未来版本）

### 7.1 高级功能
- 截图编辑（标注、涂鸦）
- OCR 文字识别
- 截图历史记录
- 批量截图上传
- 自定义文件名模板
- 截图后自动复制到剪贴板

### 7.2 智能功能
- 根据时间自动分类
- 根据内容自动添加标签
- 智能文件夹推荐
- 重复截图检测

### 7.3 集成功能
- 支持其他截图工具（CleanShot X, Xnip）
- 支持其他素材管理工具
- 支持云端备份

## 8. 测试需求

### 8.1 单元测试
- 截图模块测试
- Eagle API 模块测试
- 配置模块测试
- 工具函数测试

### 8.2 集成测试
- 完整截图上传流程测试
- 错误处理测试
- 边界情况测试

### 8.3 用户测试
- 首次使用体验测试
- 日常使用流程测试
- 配置修改测试

## 9. 文档需求

### 9.1 开发文档
- API 接口文档
- 模块设计文档
- 代码注释规范

### 9.2 用户文档
- 安装指南
- 配置指南
- 使用教程
- 常见问题解答
- 故障排除指南

## 10. 发布计划

### 10.1 版本规划
- **v1.0.0 (MVP)**：基础截图 + Eagle 上传功能
- **v1.1.0**：文件夹选择 UI
- **v1.2.0**：多种截图模式
- **v2.0.0**：高级功能

### 10.2 发布渠道
- Raycast Store（主要）
- GitHub Releases
- 个人网站/博客

## 11. 成功指标

### 11.1 技术指标
- 上传成功率 > 99%
- 平均响应时间 < 3秒
- 错误率 < 1%

### 11.2 用户指标
- 用户评分 > 4.5/5
- 安装量 > 1000
- 日活跃用户 > 100

## 12. 风险与挑战

### 12.1 技术风险
- Eagle API 稳定性依赖
- macOS 系统截图权限问题
- 大文件上传性能问题

### 12.2 用户风险
- 配置复杂度高
- Eagle 必须运行的限制
- 跨平台支持问题（目前仅 macOS）

### 12.3 应对策略
- 完善错误提示和文档
- 提供配置向导
- 考虑降级方案（保存到本地）

---

**文档版本**：v1.0  
**创建日期**：2025-11-09  
**最后更新**：2025-11-09  
**负责人**：leonwong282
